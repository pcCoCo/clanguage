# day09-内存管理

> 学习C语言有两个重要的概念:
>
> ```
> 一个是理解地址的概念，一个就是理解与之相关的内存的概念。
> ```

通常我们说道计算机的内存大家可能知道的是计算机的硬件之一。

![](/assets/memory.jpg)

```
通常这个内存概念在计算机中表述为物理内存。
```

```
在第一章我们说到计算机是一个管家，管理者整个计算机的资源，比如CPU的调度资源，内存资源等等。
```

RSS ， resident set size ，表示进程实际使用的物理内存空间

## 虚拟地址空间

VSZ ， virtual memory size ，表示进程总共使用的虚拟地址空间大小，包括进程地址空间的代码段、数据段、堆、文件映射区域、栈、内核空间等所有虚拟地址使用的总和，单位是 KB。

## 堆空间的申请和释放

malloc 使用 mmap 分配的内存 \( 大于 128k\) ， free 会调用 munmap 系统调用马上还给 OS ，实现真正释放。

堆内的内存，只有释放堆顶的空间，同时堆顶总连续空闲空间大于 128k 才使用 sbrk\(-SIZE\) 回收内存，真正归还 OS 。

堆内的空闲空间，是不会归还给 OS 的。

`频繁分配释放内存导致的性能问题`

随着系统频繁地 malloc 和 free ，尤其对于小块内存，堆内将产生越来越多不可用的碎片，导致“内存泄露”。而这种“泄露”现象使用 valgrind 是无法检测出来的。

因此，当我们写程序时，不能完全依赖 glibc 的 malloc 和 free 的实现。更好方式是建立属于进程的内存池，即一次分配 \(malloc\) 大块内存，小内存从内存池中获得，

当进程结束或该块内存不可用时，一次释放 \(free\) ，可大大减少碎片的产生。

## elf文件格式  

a

a

a

a

a

a

a

a

a

a

a

a

结束

